# Server
## 程序功能
模拟住户收到开门请求后，同意开门动作后门口机发送信息和Raley模拟器发送信息进行比对，查看是否符合配置事件。
## 设计思路
### 一、编写java服务器，多线程监听端口：
一个线程监听门口机发送的UDP信息，另外一个线程监听Raley发送的UDP信息。

程序开始后，两边同时开始监听信息，收到信息后，信息相关的静态判断（门口机一条，Raley两条）flag1,2,3变量分别置为1，静态信息变量inc1,2,3记录信息，用于后续两个线程之间的判断部分的信息共享。

哪一线程先收全消息，就先进入静态同步函数（只允许一个线程访问），另一个线程需要等待进入，函数内设定Timer（）定时器，设定2s后执行该定时器的功能函数，如果此时三条信息的判断变量flag1,2,3都为1，说明信息都收到完全，进入判断部分,查看收到的信息与自己配置表格内的信息是否一致；若有信息的判断变量仍为0，说明在规定的时间内，该信息丢失或未发送，设为超时情况，丢弃无用数据，休眠一定时间后再次打开端口收取信息。

同时静态变量flag变为0，另一个线程通过判断该变量确定该判断已经执行过一次，不执行函数的定时器部分，直接进入休眠等待下次信息的接受。执行定时器功能函数时，同时规定一个休眠时间，让线程等待功能函数执行完成后，在临近下一次信息发送间隔前进入端口打开状态，收取实时数据，防止太早打开端口收到之前的冗余数据。
如此循环，直到信息发送停止，或者退出程序。

### 二、其他信息
1.用文本文件incident.txt来储存自己正确的配置，用于后续的判断部分。

2.线程休眠时间 =  信息发送间隔时间 - 2s；（故信息发送间隔时间需要大于等于5秒，才能保证收取到之前冗余数据的概率很小）。

3.信息判断的同时将结果写入history.txt文件，后续该文件可以用来查看历史记录。

4.监听门口机端口和Raley的端口以及配置文件可以在程序开始前进行修改。

## 使用方法  
###程序开始前：主界面

![](img//%E5%9B%BE%E7%89%871.png)
1.修改配置文件：
门口机（源楼层/目的楼层）Raley（编号/通路）
添加：添加表格行数
删除：删除行（需要选中一行）
保存：文件保存（仅保存信息完整的事件）
取消：不保存修改的内容
![](https://github.com/rileyii/Server/blob/main/img/%E5%9B%BE%E7%89%872.png)
  
  
二、修改门口机和Raley端口
两个端口不能相同，且是在1-63352之间的整数。
![](https://github.com/rileyii/Server/blob/main/img/%E5%9B%BE%E7%89%873.png)


三、查看历史记录
点击查看历史记录按钮，打开history.txt文件查看
![](https://github.com/rileyii/Server/blob/main/img/%E5%9B%BE%E7%89%874.png)

###程序开始：
 输入门口机配置文件中，信息发送的间隔时间（需要符合大于等于5秒），程序需要根据此来判断线程的休眠时间。
![](https://github.com/rileyii/Server/blob/main/img/%E5%9B%BE%E7%89%875.png)
收到的信息和信息比对消息会出现在右边的文本栏中。开始后，无法编辑表格内容和修改端口号，可以查看历史记录和退出程序。
此后可以查看文本栏部分，或者历史记录部分查看发送数据和表格数据的对比结果。
